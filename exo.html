<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="style.css">
    <script src="circle.js"></script>
  </head>
  <body>
    <canvas id="canvas" width="1024" height="768">
    </canvas>

    <script>
      const canvas = document.getElementById('canvas');
      const boundings = canvas.getBoundingClientRect();
      const canvasWidth = canvas.width;
      const canvasHeight = canvas.height;

      const context = canvas.getContext('2d');
      const centerX = canvas.width / 2;
      const centerY = canvas.height / 2;

      let blackPearlArea = 0;

      const circles = []

      let circleDragged = null;

      const circlesToDraw = [
        { color: 'red', x: 200, y: 150, radius: 50, draggable: true },
        { color: 'yellow', x: 800, y: 300, radius: 50, draggable: true },
        { color: 'blue', x: 300, y: 600, radius: 50, draggable: true },
        { color: 'black', x: centerX, y: centerY, radius: 20, draggable: false }
      ]

      circlesToDraw.forEach(function(circle) {
        let newCircle = new Circle(circle);
        newCircle.context = context;

        circles.push(newCircle);

        if(circle.color == 'black') {
          blackPearlArea = Math.sqrt(Math.pow(circle.x , 2) + Math.pow(circle.y , 2))
        }
      });

      const Draw = () => {
        context.clearRect(0, 0, canvas.width, canvas.height);

        circles.forEach(function(circle) {
          circle.draw();
        })
      }

      const isDraggableCircleCliked = (mousex, mousey) => {
        circles.forEach(function(circle) {
          if(Math.sqrt(Math.pow((mousex - circle.x) , 2) + Math.pow((mousey - circle.y) , 2)) < circle.radius && circle.draggable){
            console.log(circle.color);
            return circleDragged = circle;
          }
        })
        console.log()
      }

      const isCloseToBlackPearl = () => {
        if(circleDragged) {
          const circleDraggedArea = Math.sqrt(Math.pow(circleDragged.x , 2) + Math.pow(circleDragged.y , 2))
          if (Math.abs((blackPearlArea - circleDraggedArea) + circles[3].radius) < Math.abs(50)) {
            console.log('warning');
          }
        }
      }

      Draw();

      canvas.addEventListener('mousedown', () => {
        var mouseDownX = event.clientX - boundings.left;
        var mouseDownY = event.clientY - boundings.top;
        isDraggableCircleCliked(mouseDownX, mouseDownY)
      })

      canvas.addEventListener('mousemove', () => {
        var mouseMoveX = event.clientX - boundings.left;
        var mouseMoveY = event.clientY - boundings.top;
        if(circleDragged){
          circleDragged.x = mouseMoveX;
          circleDragged.y = mouseMoveY;

          Draw();
        }
        isCloseToBlackPearl();
      })

      canvas.addEventListener('mouseup', (e) => {
        circleDragged = null;
      })


    </script>
  </body>
</html>
